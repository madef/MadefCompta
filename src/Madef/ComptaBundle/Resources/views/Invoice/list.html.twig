{% extends "MadefComptaBundle:Layout:default.html.twig" %}
{% block title %}Factures entre le {{ startDate }} et le {{ endDate }}{% endblock %}
{% block navbarContent %}
<li>
    <form method="post" class="navbar-search pull-left form-inline">
        <input type="date" id="champ1" name="start_date" value="{{ startDateRow }}" onblur="$(this).parent().submit();">
        <input type="date" id="champ2" name="end_date" value="{{ endDateRow }}" onblur="$(this).parent().submit();">
    </form>
</li>
{% endblock %}
{% block content %}
<div class="page-header">
    <form method="get" class="form-inline">
        <label>Filtrer : </label>
        <select id="type" name="type" onchange="$(this).parent().submit();">
            <option value="">Type</option>
            {% for type in typeList %}
            <option value="{{ type }}" {% if currentType == type %}selected{% endif %}>{{ type }}</option>
            {% endfor %}
        </select>
        <select id="flowDirection" name="flowDirection" onchange="$(this).parent().submit();">
            <option value="">Sens</option>
            {% for key, flowDirection in flowDirectionList %}
            <option value="{{ key }}" {% if currentFlowDirection == key %}selected{% endif %}>{{ flowDirection }}</option>
            {% endfor %}
        </select>
    </form>
</div>
{% if successMessage %}
<div class="alert alert-success">
    <button type="button" class="close" data-dismiss="alert">×</button>
        {% for message in successMessage %}
            {{ message }}{% if not loop.last %}<br />{% endif %}
        {% endfor %}
</div>
    {% endif %}
<table class="table table-striped table-hover table-bordered">
    <thead>
        <tr>
            <th>Description</th>
            <th class="date-field">Date</th>
            <th class="price-field text-right">Taux de TVA</th>
            <th class="price-field text-right">TVA</th>
            <th class="price-field text-right">HT</th>
            <th class="price-field text-right">TTC</th>
            <th class="action-field"></th>
        </tr>
    </thead>
    <tbody>
        {% for invoice in invoiceCollection %}
            <tr onclick="window.location = '{{ url('madef_compta_invoice_edit', {invoice: invoice.getId()}) }}';">
                <td>{{ invoice.getDescription() }}</td>
                <td>{{ invoice.getDate("j M. Y") }}</td>
                <td class="text-right">{{ invoice.getTaxRate()|number_format(2, ',', '\'') }} %</td>
                <td class="text-right">{{ invoice.getTaxValue()|number_format(2, ',', '\'') }} €</td>
                <td class="text-right">{{ invoice.getValueTaxExclude()|number_format(2, ',', '\'') }} €</td>
                <td class="text-right">{{ invoice.getValueTaxInclude()|number_format(2, ',', '\'') }} €</td>
                <td class="text-right">{% if invoice.hasFilename() %}<a href="{{ url('madef_compta_invoice_download', {invoice: invoice.getId()}) }}"><i class=" icon-download-alt"></i></a>{% endif %}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7">Pas d'enregistrement sur cette période.</td>
            </tr>
        {% endfor %}
            <tr class="resume">
                <th colspan="2">Total</th>
                <td class="text-right">{{ totalTaxRate|number_format(2, ',', '\'') }} %</td>
                <td class="text-right">{{ totalTaxValue|number_format(2, ',', '\'') }} €</td>
                <td class="text-right">{{ totalTaxExclude|number_format(2, ',', '\'') }} €</td>
                <td class="text-right">{{ totalTaxInclude|number_format(2, ',', '\'') }} €</td>
                <td><a href="{{ url('madef_compta_invoice_downloadlist', {startDate: startDateRow, endDate: endDateRow}) }}?type={{ currentType }}&flowDirection={{ currentFlowDirection }}"><i class=" icon-download-alt"></i></a></td>
            </tr>
        </tbody>
    </table>
{% endblock %}
